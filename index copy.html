<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Upload Example</title>
  <!-- 引入 Firebase JavaScript SDK -->
</head>

<body>

  <h1>Firebase Upload Example</h1>
  <style>
    form {
      max-width: 400px;
      margin: 0 auto;
    }

    div {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
    }

    input {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }

    button {
      padding: 10px;
    }
  </style>
  <!-- 表單 -->
  <form id="uploadForm">
    <div>
      <label for="Name">Name:</label>
      <input type="text" id="Name" name="Name" required>
    </div>
    <div class="material-container" id="materialInputs">
      <div class="material-object" id="material-object">
        <div class="input-container">
          <label for="Material">Material:</label>
          <input type="text" id="Material" name="Material" required>
        </div>
        <div class="input-container">
          <label for="Unit">Unit:</label>
          <input type="text" id="Unit" name="Unit" required>
        </div>
      </div>
    </div>
    <div>
      <label for="Description">Description:</label>
      <input type="text" id="Description" name="Description" required>
    </div>
    <button type="button" onclick="addMaterialInput()">新增 Material 輸入框</button>

    <button type="submit">上傳</button>
  </form>

  <script>
    let materialCount = 1;

    function addMaterialInput() {
      const materialInputsContainer = document.getElementById('materialInputs');

      // 創建新的 div 元素
      const newMaterialInput = document.createElement('div');
      newMaterialInput.className = 'input-container';

      // 創建 label 元素
      const label_material = document.createElement('label');
      label_material.textContent = 'Material:';
      label_material.setAttribute('for', 'Material' + materialCount);

      // 創建 input 元素
      const input_material = document.createElement('input');
      input_material.type = 'text';
      input_material.id = 'Material' + materialCount;
      input_material.name = 'Material' + materialCount;
      input_material.required = true;

      // 創建 label 元素
      const label_unit = document.createElement('label');
      label_unit.textContent = 'Unit:';
      label_unit.setAttribute('for', 'Unit' + materialCount);

      // 創建 input 元素
      const input_unit = document.createElement('input');
      input_unit.type = 'text';
      input_unit.id = 'Unit' + materialCount;
      input_unit.name = 'Unit' + materialCount;
      input_unit.required = true;

      // 將 label 和 input 添加到新的 div 元素中
      newMaterialInput.appendChild(label_material);
      newMaterialInput.appendChild(input_material);

      newMaterialInput.appendChild(label_unit);
      newMaterialInput.appendChild(input_unit);

      // 將新的 div 元素添加到容器中
      materialInputsContainer.appendChild(newMaterialInput);

      // 增加計數以確保下一個 Material 輸入框有不同的 ID
      materialCount++;
    }
  </script>
  <style>
    .material-container {
      display: flex;
      justify-content: space-between;
    }

    .input-container {
      width: 48%;
      /* 調整欄位寬度，以便在同一行顯示 */
    }
  </style>
  <!-- Firebase 初始化腳本 -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyC58TlDcuOt-OqSITwG5ehI1AEc066N5jA",
      authDomain: "cocktail-adfa8.firebaseapp.com",
      projectId: "cocktail-adfa8",
      storageBucket: "cocktail-adfa8.appspot.com",
      messagingSenderId: "295930608454",
      appId: "1:295930608454:web:6da9147968b1d9b51bc347",
      measurementId: "G-0XPS44LJRJ"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // 監聽表單提交事件
    const uploadForm = document.getElementById('uploadForm');

    uploadForm.addEventListener('submit', async function (event) {
      event.preventDefault();

      const name = document.getElementById('Name').value;
      const eposide = document.getElementById('Eposide').value;
      // const material = document.getElementById('Material').value;

      const dataObject = {
        Name: name,
        Eposide: eposide,
        Material: {}
      };

      for (let i = 1; i < materialCount; i++) {
        const materialValue = document.getElementById('Material' + i).value;
        // 添加 Material 到物件中
        dataObject.Material['Material' + i] = materialValue;
      }
      const description = document.getElementById('Description').value;

      dataObject['Description'] = description;

      console.log(dataObject);
      // 將數據上傳到 Firestore
        await addDoc(collection(db, 'userData'), {
        ...dataObject,  // 將整個 dataObject 添加到 Firestore
        timestamp: serverTimestamp(),
      });

      // 清空輸入欄位
      document.getElementById('dataInput').value = '';
    });
  </script>
</body>

</html>